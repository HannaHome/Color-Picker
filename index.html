<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>色碼選擇器</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --panel-bg: rgba(255,255,255,0.6);
    --accent: #5b8cff;
    --muted: #64748b;
    --radius: 16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans",Arial;
    background: radial-gradient(1200px 600px at 10% 10%, #f7fbff 0%, transparent 20%),
                radial-gradient(1000px 400px at 90% 90%, #fff2f8 0%, transparent 18%),
                linear-gradient(180deg,#eef5ff 0%, #fbfbff 100%);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
    color:#0f172a;
  }

  .card{
    width:980px;
    max-width:96%;
    border-radius:24px;
    background: linear-gradient(180deg, rgba(255,255,255,0.86), rgba(255,255,255,0.72));
    box-shadow: 0 12px 40px rgba(16,24,40,0.12), inset 0 1px 0 rgba(255,255,255,0.6);
    padding:22px;
    border: 1px solid rgba(99,102,241,0.06);
    backdrop-filter: blur(10px) saturate(120%);
    overflow:hidden;
  }

  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-bottom:16px;
  }
  h1{font-size:20px;margin:0;font-weight:700;color:#0b1220}
  .subtitle{font-size:12px;color:var(--muted)}

  .grid{
    display:grid;
    grid-template-columns: 1fr 340px;
    gap:18px;
    align-items:start;
  }

  .picker-wrap{
    display:flex;
    gap:14px;
    align-items:stretch;
  }

  .hs-box{
    flex:1;
    min-height:320px;
    border-radius:16px;
    overflow:hidden;
    position:relative;
    box-shadow: 0 8px 24px rgba(15,23,42,0.06);
    border:1px solid rgba(15,23,42,0.04);
    background:#fff;
  }
  canvas{display:block;width:100%;height:100%}
  .indicator{
    position:absolute;
    width:18px;height:18px;border-radius:50%;
    transform:translate(-50%,-50%);
    box-shadow: 0 0 0 4px rgba(255,255,255,0.85), 0 6px 12px rgba(2,6,23,0.25);
    pointer-events:none;
  }

  .v-box{
    width:44px;
    min-height:320px;
    border-radius:12px;
    overflow:hidden;
    position:relative;
    box-shadow: 0 8px 24px rgba(2,6,23,0.04);
    border:1px solid rgba(15,23,42,0.04);
    background:#fff;
  }
  .v-ind{
    position:absolute;
    left:0;right:0;
    height:10px;
    border-radius:6px;
    transform:translateY(-50%);
    pointer-events:none;
    box-shadow: 0 6px 10px rgba(2,6,23,0.12);
  }

  .preview{
    margin-top:14px;
    border-radius:14px;
    height:92px;
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
    font-weight:700;
    font-size:16px;
    letter-spacing:0.2px;
    border:1px solid rgba(0,0,0,0.06);
    box-shadow: inset 0 -10px 30px rgba(0,0,0,0.08);
    background:#ff0000;
  }

  .panel-right{
    padding:16px;
    background:linear-gradient(180deg,rgba(255,255,255,0.7),rgba(255,255,255,0.5));
    border-radius:14px;
    border:1px solid rgba(2,6,23,0.04);
  }

  .field{margin-bottom:12px}
  label{display:block;font-size:12px;color:var(--muted);font-weight:600;margin-bottom:6px}
  input[type="text"], input[type="number"]{
    width:100%;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid rgba(15,23,42,0.06);
    background:linear-gradient(180deg,#ffffff,#fbfdff);
    font-size:14px;
    outline:none;
    transition:box-shadow .12s, border-color .12s, transform .08s;
    text-align:center;
  }
  input[type="text"]:focus, input[type="number"]:focus{
    box-shadow:0 6px 18px rgba(59,130,246,0.12);
    border-color:var(--accent);
  }

  .row{display:flex;gap:8px}
  .row .col{flex:1}

  .copy-btn{
    margin-top:6px;
    display:inline-flex;
    gap:8px;
    align-items:center;
    justify-content:center;
    padding:8px 12px;
    border-radius:10px;
    border:1px solid rgba(15,23,42,0.06);
    background:linear-gradient(180deg,#fff,#f7fbff);
    cursor:pointer;
    font-weight:600;
    color:var(--accent);
    transition:transform .08s, box-shadow .12s;
  }
  .copy-btn:active{transform:translateY(1px)}
  .swatches{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .swatch{
    width:34px;height:34px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);
    box-shadow:0 6px 12px rgba(2,6,23,0.06);
    cursor:pointer;position:relative;
    transition:transform .12s;
  }
  .swatch:active{transform:scale(0.95);}
  .note{font-size:12px;color:var(--muted);margin-top:6px}

  .eyedropper-btn{
    padding:8px 12px;border-radius:10px;border:1px solid rgba(15,23,42,0.06);
    background:linear-gradient(180deg,#fff,#f7fbff);
    cursor:pointer;font-weight:700;color:var(--accent);
  }

  @media (max-width:880px){
    .grid{grid-template-columns:1fr}
    .picker-wrap{flex-direction:column}
    .v-box{width:100%}
    .hs-box{min-height:220px}
  }

  .toast{
    position:fixed;left:50%;transform:translateX(-50%);
    bottom:28px;padding:10px 16px;border-radius:999px;background:rgba(15,23,42,0.9);
    color:white;font-weight:600;font-size:13px;opacity:0;pointer-events:none;
    transition:opacity .18s, transform .18s;
  }
  .toast.show{opacity:1;transform:translateX(-50%) translateY(-6px);pointer-events:auto}
</style>
</head>
<body>

<div class="card" role="application" aria-label="色碼選擇器">
  <header>
    <div>
      <h1>色碼選擇器</h1>
      <div class="subtitle">即時 Hex / RGB / HSV 轉換 • 可收藏色票 • 支援拖曳與觸控</div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <button id="eyedropBtn" class="eyedropper-btn" title="從畫面擷取顏色">取色器（從畫面擷取）</button>
      <button id="resetBtn" style="padding:8px 12px;border-radius:10px;border:1px solid rgba(15,23,42,0.06);background:#fff;font-weight:700;color:var(--muted);cursor:pointer">重設</button>
    </div>
  </header>

  <div class="grid">
    <div>
      <div class="picker-wrap">
        <div class="hs-box" id="hsBox" aria-label="色相與飽和度選擇">
          <canvas id="hsCanvas"></canvas>
          <div id="hsIndicator" class="indicator" aria-hidden="true"></div>
        </div>
        <div class="v-box" id="vBox" aria-label="亮度選擇">
          <canvas id="vCanvas"></canvas>
          <div id="vIndicator" class="v-ind" aria-hidden="true"></div>
        </div>
      </div>
      <div id="preview" class="preview" aria-live="polite">#FF0000 — RGB(255,0,0)</div>
    </div>

    <aside class="panel-right" aria-label="色碼資訊">
      <div class="field">
        <label for="hex">Hex（可輸入 3 或 6 碼，# 可有可無）</label>
        <input id="hex" type="text" maxlength="7" placeholder="FF00AA 或 #FF00AA" value="#FF0000" aria-describedby="hexHelp">
        <div class="note" id="hexHelp">輸入 Hex 後會立即更新畫面</div>
      </div>

      <div class="field row">
        <div class="col">
          <label for="r">R</label>
          <input id="r" type="number" min="0" max="255" value="255">
        </div>
        <div class="col">
          <label for="g">G</label>
          <input id="g" type="number" min="0" max="255" value="0">
        </div>
        <div class="col">
          <label for="b">B</label>
          <input id="b" type="number" min="0" max="255" value="0">
        </div>
      </div>

      <div class="field row" style="align-items:center">
        <div style="flex:1">
          <label>HSV</label>
          <div style="display:flex;gap:8px">
            <input id="h" type="number" min="0" max="360" value="0" style="flex:1" />
            <input id="s" type="number" min="0" max="100" value="100" style="width:84px" />
            <input id="v" type="number" min="0" max="100" value="100" style="width:84px" />
          </div>
        </div>
      </div>

      <div style="display:flex;gap:8px;margin-top:8px">
        <div class="copy-btn" id="copyHexBtn" title="複製 Hex">複製 Hex</div>
        <div class="copy-btn" id="copyRgbBtn" title="複製 RGB">複製 RGB</div>
      </div>

      <div style="margin-top:12px">
        <label>常用色票</label>
        <div class="swatches" id="swatches"></div>
        <div class="note">點擊套用，長按可替換為自訂收藏（手機長按模擬：觸控 > 1s）</div>
      </div>
    </aside>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite">複製成功</div>

<script>
/* ===============================
   Helper color conversion utils
   =============================== */

function clamp(v,a,b){return Math.max(a,Math.min(b,v))}

function hsvToRgb(h,s,v){
  let c = v * s;
  let x = c * (1 - Math.abs((h/60) % 2 -1));
  let m = v - c;
  let r=0,g=0,b=0;
  if (h<60){ r=c; g=x; b=0; }
  else if (h<120){ r=x; g=c; b=0; }
  else if (h<180){ r=0; g=c; b=x; }
  else if (h<240){ r=0; g=x; b=c; }
  else if (h<300){ r=x; g=0; b=c; }
  else { r=c; g=0; b=x; }
  return { r: Math.round((r+m)*255), g: Math.round((g+m)*255), b: Math.round((b+m)*255) };
}

function rgbToHsv(r,g,b){
  r/=255; g/=255; b/=255;
  let max = Math.max(r,g,b), min = Math.min(r,g,b);
  let d = max-min;
  let h = 0;
  if (d===0) h = 0;
  else if (max===r) h = ((g-b)/d) % 6;
  else if (max===g) h = (b-r)/d + 2;
  else h = (r-g)/d + 4;
  h = (h * 60);
  if (h<0) h+=360;
  let s = max===0?0:d/max;
  let v = max;
  return {h:Math.round(h), s:parseFloat(s.toFixed(4)), v:parseFloat(v.toFixed(4))};
}

function rgbToHex(r,g,b){
  return [r,g,b].map(x => x.toString(16).padStart(2,'0')).join('').toUpperCase();
}
function hexToRgb(hex){
  hex = (''+hex).trim().replace(/^#/,'');

  if (hex.length===3) hex = hex.split('').map(c=>c+c).join('');
  if (!/^[0-9A-Fa-f]{6}$/.test(hex)) return null;
  return {
    r: parseInt(hex.slice(0,2),16),
    g: parseInt(hex.slice(2,4),16),
    b: parseInt(hex.slice(4,6),16)
  };
}

/* =========================
   DOM & State
========================= */
const hsCanvas = document.getElementById('hsCanvas');
const vCanvas = document.getElementById('vCanvas');
const hsCtx = hsCanvas.getContext('2d');
const vCtx = vCanvas.getContext('2d');
const hsBox = document.getElementById('hsBox');
const vBox = document.getElementById('vBox');
const hsIndicator = document.getElementById('hsIndicator');
const vIndicator = document.getElementById('vIndicator');
const preview = document.getElementById('preview');
const hexInput = document.getElementById('hex');
const rInput = document.getElementById('r');
const gInput = document.getElementById('g');
const bInput = document.getElementById('b');
const hInput = document.getElementById('h');
const sInput = document.getElementById('s');
const vInput = document.getElementById('v');
const copyHexBtn = document.getElementById('copyHexBtn');
const copyRgbBtn = document.getElementById('copyRgbBtn');
const swatchesEl = document.getElementById('swatches');
const resetBtn = document.getElementById('resetBtn');
const eyedropBtn = document.getElementById('eyedropBtn');
let state = { h:0, s:1, v:1 };
const defaultSwatches = ['#FF3B30','#FF9500','#FFCC00','#34C759','#5AC8FA','#0A84FF','#5856D6','#AF52DE','#ff7ab6','#ffd6e7','#b8ffe1','#d1e9ff','#ffe9c8'];

/* =========================
   Resize & Draw
========================= */
function resizeAll(){
  const dspr = window.devicePixelRatio||1;
  function fit(canvas, container){
    const rect = container.getBoundingClientRect();
    canvas.width = Math.max(1, Math.floor(rect.width * dspr));
    canvas.height = Math.max(1, Math.floor(rect.height * dspr));
    canvas.style.width = rect.width + 'px';
    canvas.style.height = rect.height + 'px';
    const ctx = canvas.getContext('2d');
    ctx.setTransform(dspr,0,0,dspr,0,0);
  }
  fit(hsCanvas, hsBox);
  fit(vCanvas, vBox);
  drawHS();
  drawV();
  updateUI();
}

function drawHS(){
  const w = hsCanvas.width/(window.devicePixelRatio||1);
  const h = hsCanvas.height/(window.devicePixelRatio||1);
  const grad = hsCtx.createLinearGradient(0,0,w,0);
  for(let i=0;i<=360;i+=60) grad.addColorStop(i/360,`hsl(${i},100%,50%)`);
  hsCtx.fillStyle=grad;
  hsCtx.fillRect(0,0,w,h);
  const whiteGrad = hsCtx.createLinearGradient(0,0,0,h);
  whiteGrad.addColorStop(0,'rgba(255,255,255,1)');
  whiteGrad.addColorStop(1,'rgba(255,255,255,0)');
  hsCtx.fillStyle=whiteGrad;
  hsCtx.fillRect(0,0,w,h);
  const blackGrad = hsCtx.createLinearGradient(0,0,0,h);
  blackGrad.addColorStop(0,'rgba(0,0,0,0)');
  blackGrad.addColorStop(1,'rgba(0,0,0,1)');
  hsCtx.fillStyle=blackGrad;
  hsCtx.fillRect(0,0,w,h);
}

function drawV(){
  const w = vCanvas.width/(window.devicePixelRatio||1);
  const h = vCanvas.height/(window.devicePixelRatio||1);
  const {r,g,b} = hsvToRgb(state.h,state.s,state.v);
  const grad = vCtx.createLinearGradient(0,0,0,h);
  grad.addColorStop(0,'#fff');
  grad.addColorStop(1,`rgb(${r},${g},${b})`);
  vCtx.fillStyle = grad;
  vCtx.fillRect(0,0,w,h);
}

/* =========================
   Update UI
========================= */
function updateUI(){
  const {h,s,v} = state;
  const {r,g,b} = hsvToRgb(h,s,v);
  hsIndicator.style.left = (s*hsBox.clientWidth)+'px';
  hsIndicator.style.top = ((1-h/360)*hsBox.clientHeight)+'px';
  vIndicator.style.top = ((1-v)*vBox.clientHeight)+'px';
  const hex = '#'+rgbToHex(r,g,b);
  preview.style.backgroundColor = hex;
  preview.textContent = `${hex} — RGB(${r},${g},${b})`;
  hexInput.value = hex;
  rInput.value = r;
  gInput.value = g;
  bInput.value = b;
  hInput.value = Math.round(h);
  sInput.value = Math.round(s*100);
  vInput.value = Math.round(v*100);
}

/* =========================
   Dragging
========================= */
let dragTarget = null;

function pointerDown(e){
  if(e.target===hsCanvas||e.target===hsBox) dragTarget='hs';
  else if(e.target===vCanvas||e.target===vBox) dragTarget='v';
  pointerMove(e);
  window.addEventListener('pointermove', pointerMove);
  window.addEventListener('pointerup', pointerUp);
}
function pointerMove(e){
  if(!dragTarget) return;
  const rect = dragTarget==='hs'?hsBox.getBoundingClientRect():vBox.getBoundingClientRect();
  const x = clamp(e.clientX - rect.left,0,rect.width);
  const y = clamp(e.clientY - rect.top,0,rect.height);
  if(dragTarget==='hs'){
    state.s = x/rect.width;
    state.h = 360*(1 - y/rect.height);
    drawV();
  }else if(dragTarget==='v'){
    state.v = 1 - y/rect.height;
  }
  updateUI();
}
function pointerUp(){ dragTarget=null; window.removeEventListener('pointermove', pointerMove); window.removeEventListener('pointerup', pointerUp);}
hsBox.addEventListener('pointerdown', pointerDown);
vBox.addEventListener('pointerdown', pointerDown);

/* =========================
   Inputs
========================= */
hexInput.addEventListener('input', ()=>{
  const rgb = hexToRgb(hexInput.value);
  if(!rgb) return;
  state = rgbToHsv(rgb.r,rgb.g,rgb.b);
  drawV();
  updateUI();
});
[rInput,gInput,bInput].forEach(el=>el.addEventListener('input', ()=>{
  const r=clamp(+rInput.value,0,255);
  const g=clamp(+gInput.value,0,255);
  const b=clamp(+bInput.value,0,255);
  state = rgbToHsv(r,g,b);
  drawV();
  updateUI();
}));
[hInput,sInput,vInput].forEach(el=>el.addEventListener('input', ()=>{
  const h=clamp(+hInput.value,0,360);
  const s=clamp(+sInput.value,0,100)/100;
  const v=clamp(+vInput.value,0,100)/100;
  state={h,s,v};
  drawV();
  updateUI();
}));

/* =========================
   Copy buttons
========================= */
function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg;
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),1200);
}
copyHexBtn.addEventListener('click',()=>{navigator.clipboard.writeText(hexInput.value);showToast('Hex 複製成功')});
copyRgbBtn.addEventListener('click',()=>{navigator.clipboard.writeText(`rgb(${rInput.value},${gInput.value},${bInput.value})`);showToast('RGB 複製成功')});

/* =========================
   Swatches
========================= */
function renderSwatches(){
  swatchesEl.innerHTML='';
  defaultSwatches.forEach(hex=>{
    const div=document.createElement('div');
    div.className='swatch';
    div.style.backgroundColor=hex;
    div.title=hex;
    div.addEventListener('click',()=>{hexInput.value=hex;hexInput.dispatchEvent(new Event('input'));});
    swatchesEl.appendChild(div);
  });
}
renderSwatches();

/* =========================
   Reset
========================= */
resetBtn.addEventListener('click',()=>{
  state={h:0,s:1,v:1};
  drawV();updateUI();
});

/* =========================
   Eyedropper
========================= */
if(window.EyeDropper){
  eyedropBtn.addEventListener('click', async ()=>{
    try{
      const eye = new EyeDropper();
      const result = await eye.open();
      hexInput.value = result.sRGBHex;
      hexInput.dispatchEvent(new Event('input'));
    }catch(e){}
  });
}else{
  eyedropBtn.disabled=true;
  eyedropBtn.title='此瀏覽器不支援取色器';
}

/* =========================
   Init
========================= */
window.addEventListener('resize', resizeAll);
resizeAll();
</script>
</body>
</html>

